<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <title>Donazioni terremoto</title>
    <meta name="description" content="Vuoi donare un bene o un servizio?">
    <link rel="stylesheet" href="css/style.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="apple-touch-icon" sizes="180x180" href="images/apple-touch-icon.png">
    <link rel="icon" type="image/png" href="images/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="images/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="images/manifest.json">
    <link rel="mask-icon" href="images/safari-pinned-tab.svg" color="#000000">
    <link rel="shortcut icon" href="images/favicon.ico">
    <meta name="apple-mobile-web-app-title" content="Donazioni terremoto">
    <meta name="application-name" content="Donazioni terremoto">
    <meta name="msapplication-config" content="images/browserconfig.xml">
    <meta name="theme-color" content="#4caf50">
    <meta property="og:title" content="Donazioni terremoto"/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="https://terremotocentroitalia.herokuapp.com/segnalazioni/donazioni"/>
    <meta property="og:image" content="https://terremotocentroitalia.herokuapp.com/segnalazioni/images/logo.png"/>
    <meta property="og:site_name" content="Donazioni terremoto"/>
    <link rel="canonical" href="https://terremotocentroitalia.herokuapp.com/segnalazioni/donazioni"/>
    <meta property="og:description" content="Vuoi donare un bene o un servizio?"/>
    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="@terremotocentro">
    <meta name="twitter:creator" content="@terremotocentro">
    <meta name="twitter:title" content="Donazioni terremoto">
    <meta name="twitter:url" content="https://terremotocentroitalia.herokuapp.com/segnalazioni/donazioni">
    <meta name="twitter:description" content="Vuoi donare un bene o un servizio?">
    <meta name="twitter:image:src" content="https://terremotocentroitalia.herokuapp.com/segnalazioni/images/logo.png">
    <script src="js/jquery-3.1.0.min.js" type="text/javascript"></script>
    <link rel="stylesheet" href="https://joker-x.github.io/Leaflet.geoCSV/lib/leaflet.css" />
    <!--[if lte IE 8]> <link rel="stylesheet" href="https://joker-x.github.io/Leaflet.geoCSV/lib/leaflet.ie.css" />  <![endif]-->
    <script src="https://joker-x.github.io/Leaflet.geoCSV/lib/leaflet.js"></script>
    <link rel="stylesheet" href="https://joker-x.github.io/Leaflet.geoCSV/lib/MarkerCluster.css" />
    <link rel="stylesheet" href="https://joker-x.github.io/Leaflet.geoCSV/lib/MarkerCluster.Default.css" />
    <!--[if lte IE 8]> <link rel="stylesheet" href="https://joker-x.github.io/Leaflet.geoCSV/lib/MarkerCluster.Default.ie.css" /> <![endif]-->
    <script src="src/leaflet-search2.js"></script>
    <link rel="stylesheet" href="src/leaflet-search.css" />
    <!-- jQuery 1.8.3: http://jquery.com/ -->
    <script src="http://joker-x.github.io/Leaflet.geoCSV/lib/jquery.js"></script>


    <style>
    .search-input {
     font-family:Courier
    }
    .search-input,
    .leaflet-control-search {
     max-width:400px;
    }
    #map {
       width: 100%;
       height: 20rem;
       margin-bottom: 20px;
    }
    </style>
</head>
<body>
<main>
    <form class="terremoto" id="donazioni" enctype="multipart/form-data">
        <h3>Donazioni terremoto</h3>
        <h4><a href="./">Fai un'altra segnalazione</a></h4>
        <input placeholder="Telefono" id="tel" name="tel" type="tel" autofocus>
        <input placeholder="E-mail" id="email" name="email" type="email">
        <input placeholder="Cosa (campo obbligatorio)" id="cosa" name="cosa" type="text" required>
        <textarea placeholder="Descrizione" id="descrizione" name="descrizione"></textarea>
        <div id="map"></div>
        <input placeholder="Indirizzo" type="text" id="us3-address" name="indirizzo" disabled="disabled">
        <input type="hidden" id="us3-lat" name="lat">
        <input type="hidden" id="us3-lon" name="lon">
        <input placeholder="Link (es: https://www.google.it)" id="link" name="link" type="url">
        <label for="image">Inserisci un'immagine.</label>
        <input type="file" name="image" id="image" accept="image/*">
        <a class="link" href="http://terremotocentroitalia.info/legal_segnalazioni/" target="_blank">Leggi l'informativa trattamento dati personali</a>
        <button type="submit">Inserisci donazione</button>
        <p id="result"><img id="gif" src="images/loader.gif"></p>
    </form>
</main>
<script>
var marker = L.marker();
       var map = L.map('map', {
        revealOSMControl: true,
        revealOSMControlOptions: {
            queryTemplate: '[out:json];(node(around:{radius},{lat},{lng})[name];way(around:{radius},{lat},{lng})[name][highway];);out body qt 1;'
        },
        zoomControl: true
    }).setView([42.6297405,13.2896061], 16);

    var osm=L.tileLayer('http://{s}.tile.openstreetmap.fr/hot/{z}/{x}/{y}.png', {maxZoom: 19, attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>, Tiles <a href="http://hot.openstreetmap.org/" target="_blank">Humanitarian OpenStreetMap Team</a> powered by @piersoft'}).addTo(map);
    var esi = L.tileLayer.wms("http://mapwarper.net/maps/wms/15512?request=GetCapabilities&service=WMS&version=1.1.1?", {
       layers: 'rv1',
       format: 'image/jpeg',attribution: '<a href="http://mapwarper.net/maps/15512#Preview_Map_tab" target="_blank">MapWraper with image uploaded by Napo from ESI<b>after</b> the earthquake</a> | <a href="http://openstreetmap.org">OSM</a> powered by @piersoft'});

 map.addControl( new L.Control.Search({
  url: 'http://nominatim.openstreetmap.org/search?format=json&q={s}',
  jsonpParam: 'json_callback',
  propertyName: 'display_name',
  propertyLoc: ['lat','lon'],
  circleLocation: true,
  markerLocation: true,
  autoType: false,
  autoCollapse: false,
  minLength: 2,
  zoom:18
}) );
map.on('move', function(event) {
  var marker = event.target;
  var position = map.getCenter();
  var addr='http://nominatim.openstreetmap.org/reverse?format=json&email=piersoft2@gmail.com&lat='+position.lat+'&lon=' + position.lng+'&zoom=18&addressdetails=1';
  marker = L.marker([position],16);
//  addr_search(position.lat,position.lng);
  $.getJSON(addr, function(data) {
    var indirizzo=data.display_name;
  document.getElementById("us3-address").value = indirizzo;
  document.getElementById("us3-lat").value = position.lat;
  document.getElementById("us3-lon").value = position.lng;
  console.log(position);
      //  map.setView([position.lat,position.lng],16, {animate: true});

    });
  });
var realvista = L.tileLayer.wms("http://213.215.135.196/reflector/open/service?", {
layers: 'rv1',
format: 'image/jpeg',attribution: '<a href="http://www.realvista.it/website/Joomla/" target="_blank">RealVista &copy; CC-BY Tiles</a> | <a href="http://openstreetmap.org">OSM</a> contr.s'
});


myIcon = L.icon({
iconUrl: 'pinverde.png',
iconSize: [32,32]
});

var layerControl = new L.Control.Layers({
'OSM Humanitarian': osm,
'Satellite pre terremoto': realvista,
'Satellite post terremoto': esi
}, null, {position: 'topright'});

layerControl.addTo(map);
</script>

</body>
</html>
